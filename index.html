<p style="margin:16px 0;">
  index_combined.htmlTry the new combined NAICS 2022 page (with legacy guidance)</a>
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>NAICS (2022) Search — Single Source of Truth</title>
  <meta name="description" content="Search the 2022 NAICS codes compiled by Nadhirah. Strictly uses the curated 2022 dataset; legacy codes (e.g., 454110) are not suggested." />
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin: 24px; }
    h1 { font-size: 1.3rem; margin: 0 0 6px; }
    .subtitle { color: #555; margin: 0 0 12px; }
    .row { margin: 12px 0; }
    input[type="text"] { padding: 8px 10px; font-size: 1rem; width: 360px; }
    button { padding: 8px 12px; }
    .results { margin-top: 16px; }
    .card { border: 1px solid #eee; border-radius: 8px; padding: 12px; margin-bottom: 10px; }
    .code { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace; }
  </style>
</head>
<body>
  <!-- ✅ Added link to new combined page -->
  <p style="margin:16px 0;">
    index_combined.htmlTry the new combined NAICS 2022 page (with legacy guidance)</a>
  </p>

  <h1>NAICS 2022 — Single Source of Truth</h1>
  <p class="subtitle">Search the curated 2022 NAICS dataset. Legacy codes are blocked.</p>

  <div class="row">
    <input id="searchInput" type="text" placeholder="Search by code (6 digits) or keywords…" />
    <button onclick="runSearch()">Search</button>
  </div>

  <div id="results" class="results"></div>

  <script>
    const DATA_URL = 'naics_2022_from_nadhirah.json';
    let naicsData = [];

    async function loadData() {
      naicsData = await fetch(DATA_URL).then(r => r.json());
    }

    function normalizeCode(s) {
      const d = (s || '').replace(/\D/g, '');
      return d.length >= 6 ? d.slice(0, 6) : d;
    }

    function renderResults(list) {
      const host = document.getElementById('results');
      host.innerHTML = '';
      if (!list || !list.length) {
        host.innerHTML = '<div class="card">No results found.</div>';
        return;
      }
      for (const it of list) {
        const code = it.Code || '';
        const title = it.Title || '';
        const desc = it.Description || '';
        const html = `<div class="card"><div><span class="code">${code}</span> — <strong>${title}</strong></div><div>${desc}</div></div>`;
        host.insertAdjacentHTML('beforeend', html);
      }
    }

    function keywordSearch(q, list) {
      q = (q || '').trim().toLowerCase();
      if (!q) return [];
      const words = q.split(/\s+/).filter(Boolean);
      const score = (s) => {
        const t = (s || '').toLowerCase();
        return words.reduce((acc, w) => acc + (t.includes(w) ? 1 : 0), 0);
      };
      return list.map(r => ({ r, s: score(r.Title) + score(r.Description) }))
                 .filter(o => o.s > 0)
                 .sort((a, b) => b.s - a.s)
                 .map(o => o.r);
    }

    async function runSearch() {
      const q = (document.getElementById('searchInput')?.value || '');
      const code = normalizeCode(q);
      if (/^\d{6}$/.test(code)) {
        const rec = naicsData.find(r => String(r.Code) === code);
        renderResults(rec ? [rec] : []);
        return;
      }
      const results = keywordSearch(q, naicsData);
      renderResults(results);
    }

       (async function init() {
      await loadData();
    })();
  </script>
</body>
